apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: funds-api
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: '0.0.84'
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: funds-api
    image:
      name: vibioh/funds-api
      tag: '202207101532' # {"$imagepolicy": "default:flux-funds-api:tag"}
    config:
      API_DB_HOST: funds-db
      API_DB_NAME: funds
      API_DB_PORT: '80'
      API_DB_USER: funds
      API_LOGGER_JSON: 'true'
      API_TRACER_URL: http://jaeger.monitoring:14268/api/traces
      OTEL_SERVICE_NAME: funds
    readinessProbePath: /ready
    secrets:
      API_DB_PASS: AgAjq/EnBD4MZ37HYbogiKPcZO+Dchs+936+kCLo3/9+TxejCNS5KdFWCx4VwKb9F5WriwgSHzSZfFXuLn+J8W0qneBmjuGZ29tv3IGCf2zTRZZfBo6j58+UPHn3pvtrpRgSCij8ila7CmKexMWh22oV9Dibr+TsS+ID8HQYzLCgnPQLMs4akut0Zl9EFtbA7DAklbhPnhzJUJe4AzSR5zOm0mDLofsSKP1vWES2ce9dHKyGaCeZlN99cL8HhBUPRgyzRcCuX8uEVWSuTE51qvsBJzWjJg5RR5cgvNbig5ZuHHlCKHQSlFf0oNdiM+6ZaudTOkHA8xjrQF3EbHtTyZEmc6y1qhjPH37T4ns9l2O2H09VgYSJMfDS69aOsX58wK1yUXVRs3qAMS0qkj2E/mSELa2Ld4FnSjAQTqIqa18e3WL0/Dof4m9A1hkH/pFV/vsEqitoRRpWeI5kTfm25yflQ34rXBmDFcv++OLnUTc2zhbDvTWu81wPybwwGMgxqFmLD2cxndoUHZtpvf+bstJOsIPCt/zCH6n0HYYtjMQbJC/UXxREF2PuGFQzrHlbIMcn4W1OeOci0a1FF5Sp9H9lWTd8TlpXerYJHbQrbwtp4/pTMr4iGMo/eWig0bkeGf8X2WhAb2PolWPffS5yxSpwb8w/E8mG+8lY8Cm/EbiCVv2LM6udfx4OEJ/kaeMk/1BFYqLREo23kNdbmMo36oxyWm3NbehLETnp3srixAs5cu0g93CiwBRUT/mJCbtY1wvzI+nSMFqIYetUPSw=
      API_INFOS: AgAHn4jmgSo60jQCZRDTgT0gUB+xSKzHC9pflkGrrkwFycNqLu+UisXgNq+tMfx2M+dnmUzh+pfrUBf0/k/chmLg58LtHk2yeL7T9MPqo6Y8ZnpsCDzIyOL6bO8JTOgd8vzgEyg3XdyycVRd+gz8xircZZ/jVoQNrpgkm76ekQ/3bay2mkOzsgSdIy3YSz7XZ4kveKOP+znt6sqsFwNeL1BiH+o6PVEFG3uSO9NRKNKQDMiw6AVfPrted/Wifhy4U2E+JvLABMQh6/wZJhfO3hc3AaiV/9/8rhv2fatXj5iNEyaU2Ecvd0qPdO1o7Jqzz9qZXJGUWyvvGWgrK91P0VAALieyWEX0dvZumtwSKIyXl1JmcU9soE4j7Mqmtgrsea0u47WoZGx9ody9S7KYvDvyTTIatMNhjxFUXtp8fNxjdgZ53eNxdP5FHF55wuVGmJiJgnJyoqo3K3M+06TWu6Tbqct8O9q8KZq2uFLCrQ2Unl2CsFwJdYlPezAqdAJOsvQ4U5b/QgBFW49q73zzjeKS6LX5zcCeZAf10r2Oo6Gi6Q0wb5QB9pepRpHvcFSFsoMGaN1w7IhaUf6QTUQb/RFUfNl7s+fdx7bXEqWP/RQ7XSdzHfyWOx0Yr80QiKbrbXn38uTJR9JbXfHGwkDjw/XHNuhQhvuSN50gM/TWRnk1ljEx7OXkyJ+qX40o1ynyVi+oWLRv3btfv5c1/ybc1nE3bUhFAXuxRk6th+Z/kIanwms9/36TbdpkSVQM7I4JHcmwVYI9R5oF5NA3ZyMGGQ==
    ingress:
      enabled: true
      hosts:
        - funds-api.vibioh.fr
    pprof:
      enabled: true
    affinity:
      podAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                  - key: app.kubernetes.io/instance
                    operator: In
                    values:
                      - funds-db
              topologyKey: 'kubernetes.io/hostname'
